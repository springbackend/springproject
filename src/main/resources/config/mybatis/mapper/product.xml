<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="p">
	<select id="select_category" resultType="product"
		parameterType="java.util.Map">
		select * from (select rank() over(order by p_idx desc)
		no,
		p.* from product p where p.p_category_b = #{p_category_b}) where no
		between #{start} and #{end}
	</select>

	<select id="select_category_count" resultType="int"
		parameterType="String">
		select count(*) from product where p_category_b =
		#{p_category_b}
	</select>
	<select id="select_product_view" resultType="product"
		parameterType="int">
		select * from product where p_idx = #{p_idx}
	</select>


	<update id="buy_product" parameterType="java.util.Map">
		update product set p_sold
		= p_sold + #{quantity} where p_idx = #{p_idx}
	</update>

	<select id="buy_product_view" resultType="product"
		parameterType="int">
		select * from product where p_idx = #{p_idx}
	</select>

	<select id="select_category_s" resultType="product"
		parameterType="java.util.Map">
		select * from (select rank() over(order by p_idx desc)
		no,
		p.* from product p where p.p_category_s = #{p_category_s}) where no
		between #{start} and #{end}
	</select>

	<select id="select_category_s_count" resultType="int"
		parameterType="String">
		select count(*) from product where p_category_s =
		#{p_category_s}
	</select>

	<select id="select_best" resultType="product">
		select * from (select rank()
		over(order by p_sold desc,p_idx) no,
		p.* from product p order by
		p.p_sold desc) where no between 1 and 20
	</select>

	<select id="select_best_main" resultType="product">
		SELECT *
		FROM (SELECT *
		FROM product ORDER BY p_sold DESC) where ROWNUM between 1 and 6
	</select>

	<select id="select_discount" resultType="product">
		SELECT * FROM (
		SELECT bp.p_idx, p.p_name, SUM(bp.p_count) AS total_sold
		FROM buy_product bp
		JOIN product p ON bp.p_idx = p.p_idx
		WHERE bp.bp_regidate >= TRUNC(SYSDATE - 1)
		AND bp.bp_regidate <![CDATA[<]]> TRUNC(SYSDATE)
		GROUP BY bp.p_idx, p.p_name
		ORDER BY SUM(bp.p_count) ASC
		)
		WHERE ROWNUM between 1 and 6
	</select>
</mapper>





















